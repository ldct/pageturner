<html>

<pre id="volume"></pre>

<canvas width=400 height=200 id="freq"></canvas>

<script src="https://code.jquery.com/jquery-1.11.1.js"></script>

<script>
window.AudioContext = window.AudioContext ||
                      window.webkitAudioContext;

var context = new AudioContext();

navigator.getUserMedia = (navigator.getUserMedia ||
                          navigator.webkitGetUserMedia ||
                          navigator.mozGetUserMedia ||
                          navigator.msGetUserMedia);

analyser = context.createAnalyser();
analyser.smoothingTimeConstant = 0.3;
analyser.fftSize = 1024;
var bufferLength = analyser.frequencyBinCount;
var dataArray = new Uint8Array(bufferLength);

navigator.getUserMedia({audio: true}, function(stream) {
  window.microphone = context.createMediaStreamSource(stream);

  microphone.connect(analyser);

}, function() {
  console.log('error');
});

WIDTH = 400;
HEIGHT = 200;
var canvasCtx = $('#freq')[0].getContext("2d");
canvasCtx.clearRect(0, 0, WIDTH, HEIGHT);

function draw() {
  requestAnimationFrame(draw);
  analyser.getByteFrequencyData(dataArray);
  canvasCtx.fillStyle = 'rgb(0, 0, 0)';
  canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);

  var barWidth = (WIDTH / bufferLength) * 2.5;
  var barHeight;
  var x = 0;

  for(var i = 0; i < bufferLength; i++) {
    barHeight = (dataArray[i]) * HEIGHT / 255;
    canvasCtx.fillStyle = 'rgb(' + Math.floor(barHeight+100) + ',50,50)';
    canvasCtx.fillRect(x,HEIGHT-barHeight,barWidth,barHeight);
    x += barWidth + 1;
  }
};

draw();

</script>
</html>